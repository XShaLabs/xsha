# Development environment Dockerfile
FROM m.daocloud.io/docker.io/library/golang:1.24-alpine AS development

# Update package index and install necessary tools including Docker CLI and build dependencies for CGO
RUN apk update && apk add --no-cache git ca-certificates tzdata curl make docker-cli gcc musl-dev sqlite-dev

# Set timezone
ENV TZ=Asia/Shanghai

# Install air (for hot reload)
RUN go install github.com/air-verse/air@v1.62.0

# Set working directory
WORKDIR /app

# Copy go mod files
COPY backend/go.mod backend/go.sum ./

# Download dependencies
RUN go mod download

# Create data directory
RUN mkdir -p /app/data

# Create tmp directory for air
RUN mkdir -p /app/tmp

# Expose port
EXPOSE 8080

# Copy startup script
COPY <<EOF /startup.sh
#!/bin/sh
cd /app
exec air -c .air.toml
EOF

RUN chmod +x /startup.sh

# Default command
CMD ["/startup.sh"] 